# Loader Function Documentation

## Overview

The `LoadMarkdown` function is responsible for loading Markdown files from a specified directory, processing them, and converting them into HTML. It utilizes goroutines (concurrency) to process multiple files concurrently, improving performance when loading large collections of Markdown files. This function also updates the DOM object with the generated HTML content for each page.

## Function Purpose

The primary purpose of the `LoadMarkdown` function is to:

1. Walk through a specified directory (`baseDir`).
2. Identify Markdown files (`.md` extension) within that directory.
3. Read the content of the Markdown files.
4. Convert the Markdown content to HTML using a worker pool (goroutines).
5. Store the converted HTML into the corresponding `Page` struct inside the DOM object.

## Function Signature

````go
```go
func (d *DOM) LoadMarkdown(baseDir string) error
```
#### Parameters:
- `baseDir`: A string representing the directory to walk through in order to find `.md` files.

#### Return Value:
- Returns an `error` if there was an issue during file reading, content processing, or HTML conversion.

### How the Function Works

1. **Initializing Channels and WaitGroup**:
    The function starts by setting up a buffered channel (`taskChan`) that will be used to pass the URIs of Markdown files for HTML processing. It also initializes a `sync.WaitGroup` (`wg`) to manage the completion of tasks.

    ```go
    taskChan := make(chan string, 10) // Buffered channel
    wg := &sync.WaitGroup{}
    ```

2. **Starting Worker Goroutines**:
    A pool of worker goroutines is launched, where each goroutine listens for URIs from the `taskChan` channel. These workers will process the Markdown content and generate the HTML. A total of 4 workers are created by default.

    ```go
    numWorkers := 4
    for i := 0; i < numWorkers; i++ {
        go d.htmlWorker(taskChan, wg)  // Start each worker as a goroutine
    }
    ```

3. **Walking the Directory**:
    The `filepath.Walk` function is used to recursively walk through the provided `baseDir` and process each file. For each file, the function checks if the file is a Markdown file (determined by the `.md` extension). If the file is a Markdown file, the function proceeds to read its content.

    ```go
    err := filepath.Walk(baseDir, func(path string, info os.FileInfo, err error) error {
        if err != nil {
            d.Logger.Errorf("Error walking the directory: %v", err)
            return err
        }

        if !info.IsDir() && strings.HasSuffix(info.Name(), ".md") {
            // Process the Markdown file
        }
    })
    ```

4. **Generating URI and Adding to DOM**:
    The URI for each Markdown file is generated by trimming the `baseDir` from the file path, removing the `.md` extension, and replacing any directory separators with slashes (`/`). This URI is then used to add the Markdown content to the DOM.

    ```go
    uri := strings.TrimPrefix(path, baseDir)
    uri = strings.TrimSuffix(uri, ".md")
    uri = strings.ReplaceAll(uri, string(os.PathSeparator), "/")

    // Log the filtered URI
    d.Logger.Infof("Filtered URI: %s", uri)

    // Add the page to the DOM with its Markdown content
    d.mu.Lock()
    d.Pages[uri] = &Page{Markdown: string(content)}
    d.mu.Unlock()
    ```

5. **Sending URIs to Workers**:
    The URI of the newly added Markdown page is sent to the `taskChan` channel, signaling the worker to process the content and generate the corresponding HTML.

    ```go
    wg.Add(1)
    taskChan <- uri
    ```

6. **Waiting for Workers**:
    Once all URIs are sent to the `taskChan`, the function waits for all worker goroutines to complete their tasks by calling `wg.Wait()`. This ensures that all Markdown files are processed before the function returns.

    ```go
    close(taskChan)
    wg.Wait()
    ```

7. **Logging**:
    Throughout the function, various log messages are generated to help monitor the loading process. Logs are generated when:
    - The Markdown files are being loaded.
    - Each URI is filtered and added to the DOM.
    - Workers are processing Markdown content.
    - HTML content is generated and added to the `DOM`.

---


````
